---
title: "change dive num for split dives"
output:
  pdf_document: default
params: 
  type: "diveinfo"
  id: "dive_table_id"
  db: "Leyte"
  first: NA
  last: NA

  
---

Access database.
```{r workspace, echo = F, message=FALSE}

source("../genomics/scripts/lab_helpers.R")
write <- write_db(params$db)
library(knitr)

# pull in entire db table
db <- read_db(params$db)
dat <- db %>% tbl(params$type) %>% collect()
```
Find the range of rows to be changed
```{r change}
dat <- db %>% 
  tbl(params$type) %>% 
  collect()

change <- dat %>% 
  filter(dive_table_id == 588 | dive_table_id == 324) %>% 
  mutate(corr_message = paste(corr_message, "changed dive_num to reflect split", sep = ", "), 
         dive_num = ifelse(dive_table_id == 324, 40.1, dive_num), 
         dive_num = ifelse(dive_table_id == 588, 40.2, dive_num))

dat <- change_rows(dat, change, params$id)

```


# Write to database
```{r write}
# backup 
backup <- leyte %>% 
  tbl(params$type) %>% 
  collect()

write_rds(backup, path = paste0("~/Documents/db_backups/", Sys.Date(), "_", params$type, ".Rdata"))

# dbWriteTable(write, params$type, dat, row.names = F, overwrite = T, append = F)
# dbDisconnect(write)
```

