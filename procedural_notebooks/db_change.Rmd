---
title: "change anem_table_id for same anem"
output:
  html_notebook: default
params: 
  type: "clownfish"
  id: "fish_table_id"
  db: "Leyte"
  first: NA
  last: NA

  
---

Access database.
```{r workspace, echo = F, message=FALSE}

source("../genomics/scripts/lab_helpers.R")
write <- write_db(params$db)
library(knitr)

# pull in entire db table
db <- read_db(params$db)
dat <- db %>% tbl(params$type) %>% collect()
```
Find the range of rows to be changed
```{r change}
change <- dat %>%
  filter(anem_table_id == 7492) %>% 
  mutate(anem_table_id = 7491, 
    correction = "Y", 
    corr_editor = "MRS", 
    corr_date = "2018-10-19", 
    corr_message = "Changed anem_table_id from 7492 to 7491 because these fish were on anem_id 2422 seen at 10:56 on 2016-05-31")

dat <- change_rows(dat, change, "fish_table_id")

```


# Write to database
```{r write}
# backup 
backup <- leyte %>% 
  tbl(params$type) %>% 
  collect()

write_rds(backup, path = paste0("~/Documents/db_backups/", Sys.Date(), "_", params$type, ".Rdata"))

# dbWriteTable(write, params$type, dat, row.names = F, overwrite = T)
# dbDisconnect(write)
```

