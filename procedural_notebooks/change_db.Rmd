---
title: "Change Database"
output:
  pdf_document: default
  html_notebook: default
---

This script will change rows in the database to update information.
```{r echo = F, message=FALSE}
source("../genomics/scripts/lab_helpers.R")
lab <- write_db("Laboratory")
library(knitr)
```

Find which samples are in the csv of rescues that are not in the next plate of digests
```{r echo = F}
# pull in all table
# extr <- lab %>% dbReadTable("extraction") %>% collect()
digs <- lab %>% dbReadTable("digest") %>% collect()
# ligs <- lab %>% dbReadTable("ligation") %>% collect()

# list of extraction_ids to change
infile <- "../../laboratory/data/attempt_to_rescue_as_of_2018-05-22.csv"
samples <- read.csv(infile, stringsAsFactors = F)

# narrow down the digests to the most recent plate
digs <- digs %>% 
  filter(is.na(date), is.na(enzymes))

missing <- samples %>% 
  filter(!extraction_id %in% digs$extraction_id)
kable(missing)




################### BE CAREFUL ########################################
# dbWriteTable(lab, "extraction", extr, row.names = F, overwrite = T)
# dbWriteTable(lab, "digest", digs, row.names = F, overwrite = T)
# dbWriteTable(lab, "ligation", ligs, row.names = F, overwrite = T)
# 
# dbDisconnect(lab)
# rm(lab)

```
